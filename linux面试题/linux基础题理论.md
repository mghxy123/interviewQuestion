# 运维理论题



##### 1、什么是运维？

- 运维是指已经建立好的网络软硬件的维护，就是要保证业务上线与运行的正常，在网站运行的过程中，对其进行维护，它集合了网络，系统，数据库，开发，安全，监控于一身的技术，运维又分为，系统运维、业务运维、应用运维监控运维、DBA运维、开发运维等。

##### 2、你对现在运维工程师的理解和对其工作的认识？

- 要有安全意识：
  - 运维人员的权限很大， 所以一定要保证账号/私钥的安全。
  - 最好使用加密工具存储，基于本地存储，切勿使用网盘
  - 否则丢失了，奉献会非常大
- 要有责任性：
  - 要有Owner意识，遇到报警第一时间处理，而不是等着他人去处理
  - 如果无法处理，应该第一时间寻求同事协助帮忙，和上报领导，而不要禁止报警，来掩盖问题，
- 细心：
  - 你的任何一个操作都可能造成系统的损坏、业务出问题。
  - 所以一定要在敲命令时细心、确认再三；你敲得再快，也就节约那么一点点时间，出了问题才是大事
- 推进/改善：
  - 如果代码有问题，导致系统开销很大，比如负载，IO等。应该第一时间和开发不确认，要求代码优化，
- 还需要有进取心，不断的学习提升自我

##### 3、现在给你300台服务器，你怎么对他们进行管理？

- 对于新的服务器首先使用pex+kickstart批量安装系统，并把配置都放在安装后脚本里面，完成初始化。

- 设定跳板机，使用统一账号登录便于安全与登录的考量。
- 使用saltstack、ansiable进行系统的统一调度与配置的统一管理，并按需求或者业务进行分组。
- 建立简单的服务器系统、配置、引用的cmdb信息管理系统；变异查阅每台服务器上的各种信息记录。

##### 4、简述raid0、raid1、raid5、raid10几种工作原理和特点！

- raid0 可以是一块盘或是N块盘的组合
  - 优点：读写快，读写速度是raid中最快的
  - 缺点：没有冗余，一块盘坏了，数据就丢失了

- raid1 只能两块盘，一块写数据，一块做备份
  - 优点：100%冗余备份
  - 缺点：读写速度一般，成本高
- raid5 3块以上的盘组成，容量是（n-1）*硬盘容量
  - 优点：成本不算太高还有冗余
  - 缺点：读写性能一般，度还好一点，写性能很低

- raid10 集合了raid0和raid1的优点
  - 优点：读写速度块，冗余100%
  - 缺点：成本高
- radi性价比
  - 冗余 ： raid1 > radi10 > radi5 > raid0
  - 性能   :  raid0 > raid10 > raid5 > raid1
  - 成本   :  raid0 > raid5 >raid1 > raid10
- raid的建议使用场景:
  - 单台服务器: 由于是单台数据丢了就没了,所以建议使用 raid1
  - 数据库服务器: 主库(raid10) 从库(raid5/radi0) 但是为了节约成本也可以用raid10
  - web服务器: 如果没有太多的数据,可以使用radi5/ raid0
  - 监控应用服务器: raid0 raid5

- 

##### 5、squid、varnish和nginx有什么区别？工作中你怎么选择？

- 这三者都是代理服务器

- 什么是代理服务器？

  - 能代理用户去公网，并且能把访问到的数据缓存到服务器本地，等用户下次在访问相同资源的时候，代理服务器直接从本地返回给用户；本地没有的时候，能够代替用户去访问公网，把结果资源缓存到本地，用户来访问时直接返回给用户；有就直接给用户返回。

- 区别：

  - nginx本来是方向代理，web服务器用了插件这就成了副业，但是本身不支持，只能缓存静态文件
  - 从功能上来说，varnish和squid是专业的cache服务，
  - varnish奔上的优势哟啊高于squid，它采用了可视化的页面缓存技术

  - 在内存上利用，varnish比squid具有优势，性能上也比squid要高。

  - 还有强大的通过varnish管理接口，可以使用正则表达式传递，批量清除缓存部分。

- 工作中的选择：

  - 如果是专业的缓存服务器的环最好还是使用varnish

##### 6、什么是中间件？什么是jdk？

- 中间件：
  - 是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源
  - 中间件位于客户机/服务器的操作系统之上,管理计算机资源和网络通讯的
  - 是连接两个独立应用程序或独立系统的软件;使他们相互连接的系统,即使他们具有不同的接口
  - 通过中间件,应用程序可以工作于多个品台或系统环境.
- jdk是java的开发工具包;它是一种构建在java平台上发布的应用程序,applet和主键开发环境.

##### 7、讲述一下tomcat 的8005、8009、8080三个端口的含义？

- 8005： 关闭是使用
- 8009： 为ajp端口，及容器使用，如apache能通过ajp协议访问tomcat的8009端口
- 8080： 为一般应用使用

##### 8、什么叫做CDN？

- 即内容分发网络
- 其目的是通过现有的internet中增加一层新的网络架构，将网站的内容发不发哦最近用户的网络边缘，让用户就近取得所需的内容，提高用户访问网站的速度，增强用户体验。

##### 9、什么叫网站灰度发布？

- 灰度发布指的是在黑与白之间，能够平滑过渡的一种发布方式
- AB test就是一种灰度发布方式，让一部分用户开始使用B版本，一部分继续沿用A版本。
- 如果B部分用户体验好，或者没有在线上出什么BUG的话，那么就扩大范围发布B版本
- 灰度发布可以摆正整体系统的稳定，在初期会读的时候就可以发现，并调整问题，以保证开发效率。

##### 10、简述下DNS镜像域名解析的过程？

- 用户访问`www.baidu.com`，会先找本机的hosts文件，然后在去找本地指向的DNS服务器，如还没找到的话，就去网络中找根服务器，根据服务器反馈的结果，说只能提供一级域名.cn,就要去一级域名服务器去找，一级域名服务器说只能提供二级域名服务器.com.cn，然后就到二级域名服务器上去找，找到了三级域名服务器，三级域名服务器提供了baidu.com.cn，三级域名服务就发给请求的服务器，请求的服务器自己保存一份之后就发给客户端。

##### 11、RabbitMQ是什么的？

- RabbitMQ是消息队列中间件，消息中间件是在消息传送过程中的容器
- 当消费者需要的时候再从消息队列中拿出去，实现了解耦的功能
- 消息队列主要的作用his提供路由并保证消息的传递；如果发送消息时接受者不呢用，消息队列不会再不能存消息，直到可以充公的传递为止

##### 12、讲一下keepalive的工作原理？

- 它工作在一个虚拟路由中，只有作为master在工作，且master的vrrp路由会一直发送vrrp通告信息，
- backup不会抢占master，只有当backup接收不到master的vrrp时，才会抢占master这种速度很快，不到1S，以保证服务的连续性。
- 处于安全方面的考虑，vrrp包进行了加密，backup不会发送通告信息，直接接受通告信息。

##### 13、讲述一下lvs三种模式下的工作过程，和lvs的几种算法？

- nat模式：
  - 原理：
    - 在接收到用户端的包后，把目的地址变成后端RS的地址，继续向后发送；
    - 当后端的RS处理完成后，再把返回包的目的地之变成客户端的地址，发送出去
    - 进进出出都需要经过nat服务器的转换
  - 优点：
    - 集群中的物理服务器可以使用任何TCP/IP的操作系统，且负载均衡器只需要一个合法的IP地址即可
  - 缺点：
    - 有扩展的局限性，当服务器节点达到一定数量（20台或更多）时，负载均衡器将成为整个架构系统的瓶颈，应为请求和应答包都需要负载均衡器再生，而负载均衡器的能力有限。会导致速度变慢
- 隧道模式（tunnel）
  - 原理：
    - 在接收到客户端的数据包后，负载均衡器会把数据包的目的地址直接变成RS的地址，然后发给RS；RS处理完成后直接把数据包发送给客户端，不需要再经过负载均衡器，但是要求RS必须支持iptunnel协议
  - 优点：
    - 负载均衡器只负责将数据包发送给后端RS，减少了负载军很气的大量数据流动,负载军很气不再是系统瓶颈
  - 缺点:
    - 隧道模式的ES节点都需要合法的IP,这种方式需要的服务器都支持IPTunnel协议,所以服务器只限于linux系统之上.
- 直接路由(DR)
  - 原理：
    - 负载均衡器RS都是用一个IP对外进行服务，但是之后DR对ARP请求进行相应所有的RS本身这个IP的ARP请求保持静默，也就是说，网关会把这个服务IP的请求全部定向给DR，而DR收到数据包后根据调度算法，找出相对应的RS，吧目的的MAC地址改成RS的MAC（应为IP完全一致），将请求分发到RS，接收并处理完后，由于IP一致，所以直接将数据报返回给客户端
  - 优点：
    - 和TUN模式一样，负载军很气只是发送请求，尹大宝通过单独的路由方法返回给客户端，与TUN相比，DR不需要隧道结构，因此可以使用在大多数的操作系统上
  - 缺点：
    - 要求负载均衡器的网卡必须与物理网卡在一个物理网段上。

##### 14、mysql的innodb如何定位锁问题？MySQL如何减少主从复制延迟？

- MySQL的InnoDB如何定位锁问题：

  - 检查索引状态，show engine innodb status  法宣死锁问题
  - 在5.5中,information_schema库中增加了三个关于锁的表(MEMORY引擎)
  - innodb_trx  ## 当前运行的所有事务
  - innodb_locks # 当前出现的锁
  - innodb_lock_waits # 所等待的对应关系

- MySQL如何减少主从复制延迟?

  - 从库硬件比主库差,导致复制延迟
  - 从库赋值单线程,如果主库写并发太大,来不及传送到从库,就会导致发言吃,更高版本的mysql可以支持多线程复制

  - 慢sql语句过多

  - 网络延迟

  - master负载过高,主库读写压力过大,导致复制延迟,架构的前端要加buffer级缓存

  - slave负载过大,使用多台slave来分摊读的清秀,再从这些slave中读取一台专用的服务器作为备用,不进行其他操作;还可以修改下面两个参数减少延迟

    - `--master-connect-retry=seconds` 单位为秒 默认是60秒
    - 含义是 当重新简历主从连接是,如果连接建立失败,间隔多久重试

    - `--slave-net-timeout=seconds` 单位是秒 默认设置为3600秒
    - 含义是 slave从主库读取log数据失败后,等待多长时间,重新去获取数据

##### 15、如何重置mysql root密码？

- 在已知的mysql数据库root密码的情况下，修改密码：
  - 直接在shell环境下，使用mysqladmin命令设置：
    - `sqladmin -uroot -p oldpasswd 'newpasswd'`
  - 在mysql中使用update更新user表
    - `update mysql.user set password=password("newpasswd") where user='root';`
    - `flush privileges;`
  - 在mysql中,使用grant命令,修改root用户的授权权限
    - `grant all on *.* to  root@'localhost' identfied by 'newpasswd'`
- 在忘记或丢失root密码的情况下:
  - 关闭当前运行的mysql数据库进程,`service mysqld stop`
  - 使用mysql_safe脚本,启动mysql进入安全模式下
  - 使用空密码的root用户登录数据库,重新设置root用户的密码
    - `mysql -uroot `
    - `update mysql.user set password=password('newpassword') where user='root';`
    - `flush privileges;`

##### 16、lvs、nginx、haproxy有什么区别？工作中你怎么选择？

- lvs：基于四层的网络转发，没有流量的产生
- nginx：是基于七层的应用转发，可以做缓存、反向代理和web服务器
- haproxy：是基于四层和七层的转发，是专业的代理服务器
- 三者的区别：
  - lvs是基于四层所以只能做端口的转发
  - 而基于url的、基于目录的这样的转发lvs做不了，只能交给nignx和haproxy
- 工作选择，haproxy和nginx由于可以做七层的转发，所以url和目录的转发都可以做
- 在很大的并发的时候我们需要选择的是lvs，像中小型公司没有并发量那么大的话选择haproxy或者是nginx 就足够了，由于haproxy是专业的代理服务器所以配制简单，所以中小型企业推荐使用haproxy。

##### 17、lvs、nginx、haproxy的优缺点

- nginx：

  - 优点：
    - 工作在网络的七层，可以针对http应用做一些分流策略，比如仅对域名、目录结构他的正则规则比haproxy更为强大和灵活，所以目前为止广泛流行。
    - 对于网络的稳定性以来非常小，理论上能ping通就能进行负载工能
    - 安装和配置比较简单， 测试比较方便，它基本能把错误日志打印出来
    - 可承受高负载压力且稳定，硬件不差的情况下一般支撑几万次的并发量，负载度比较lvs要小
    - nginx可以通过端口检测到服务器内部的故障，根据服务器处理网页但会的状态码，超时等；并会把返回错误的请求重新提交到另一个节点
    - 不仅仅是优秀的负载均衡器/方向代理软件，同时也是很强大的Web应用服务器。lnmp也是非常流行的web架构，在高流量的环境中稳定性也很好
    - 渴作用中层反向代理使用
    - 可作为静态页面和图片服务器
    - nginx的社区活跃、第三方模块非常多，相关资料在网上比比皆是

  - nginx缺点：
    - 适应范围较小，仅能支持http、https、email协议
    - 对后端服务器的检查，只支持通过端口检查，不支持url来检测。
      - 比如用户在上传一个文件，而处理上传的节点刚好在上传的过程中出现了故障，nginx会把上传到另一台服务器重新处理，而lvs就直接断掉了，如果上传一个很大的文件或者很重要的文件的话用户可能会因此而不满；

- lvs：

  - 优点：
    - 抗负载能力强，工作在网络四层，静用于分发之用，没有流量的产生，这个特点也决定了它在负载均衡软件的性能里面最强，对内存和cpu次元消耗比较低
    - 配置性比较低，这是一个缺点，也是一个优点，应为没有太多可配置的东西，所以并不需要太多接触，大大减少了认为出错的几率
    - 工作稳定，因为其本身抗负载能力超强， 本身有完整的双机热备方案，如lvs+keepalive，不过在项目实施中用的最多的还是lvs/DR+keepalive
    - 无流量，lvs只是分发请求，而流量并不从它本身出去，这点保证了负载均衡的IO的性能不会受到大流量的影响
    - 应用范围比较广，应为lvs工作在四层，所以它几乎可以对所有应用负载均衡，包括http、数据库、在线聊天室等等
  - 缺点：
    - 软件本身不支持正则表达式处理，不能做动静分离；而现在许多网站在这方面都有比较强的需求，这个是nginx、haproxy+keepalive的优势所在
    - 如果是网站应用较庞大的话，LVS/DR+Keepalive实施维护就比较复杂了， 特别后面还有Windows server的机器的话；如果实时配置还有维护过程比较复杂了，相对而言nginx/haproxy+keeplive就简单多了

- haproxy：

  - 优点
    - 支持虚拟主机，可工作在4/7层（支持多网段）
    - haproxy的优点能够补充nginx的一些缺点，比如session的保持，cookie的引导；同时支持通过获取指定的url来检测后端的服务器状态
    - haproxy跟lvs类似，本身就只是一款负载均衡软件；单纯从效率上来讲haproxy会比nginx更为出色，在处理并发能力上也有雨nginx
    - haproxy支持tcp协议的负载均衡转发，可以对mysql读进行负载均衡，对后端的mysql节点进行监测和负载均衡，咳哟用lvs+keepalive对mysql主从做负载均衡
    - haproxy负载均衡策略很多，haproxy的负载均衡算法具体有八种：roundrobin、leastconn、static-rr、source、uri、url_param、hdr、hdr-cookie

  - 缺点：
    - 不支持pop/smtp协议
    - 不支持spdy
    - 不支持http cache功能. 现在不少开源的lb项目,都或多或少具备http cache功能
    - 重载配的的功能需要重启进程,虽然也是soft restart, 但是没有nginx的reload平滑和友好
    - 多京城模式支持的不够好

##### 18、统计ip访问前十的ip

- `cat access.log|awk '{print $1}'|uniq -c|sort -rn|head -10`
- `awk '{a[$1]++} END{for(i in a) print i, a[i]| sort -nr|head -n 10}' access.log`

##### 19、使用tcpdump监听主机为192.168.1.1,tcp端口为80的数据,同时将输出结果保存到tcpdump.log

- `tcpdump 'host 192.168.1.1 and port 80' > tcpdump.log`

##### 20、如何将本地80端口的请求转发到8080端口，挡圈主机ip为192.168.2.1

- `iptables -A PREROUTING -d 192.168.2.1 -p tcp -m tcp -dport 80 -j DNAT -to-destination 192.168.2.1:8080`

##### 21、实时专区并显示当前系统中tcp端口的网络数据信息，请写出完成的命令！

- `tcpdump -nn tcp port 80`

##### 22、通过netstat和awk查看服务器的连接数

- 查看所有连接数

- `netstat -n|awk '{++S[$NF]} END{for(a in S) print a, S[a]}'`
- 查看TCP连接数
- `netstat -n|grep ^tcp|awk '{++s[$NF]} END{for(a in s) print a, s[a]}'`

| 状态        | 描述                            |
| ----------- | ------------------------------- |
| closed      | 无连接是活动的或正在进行        |
| listen      | 服务器在等待进入呼叫            |
| syn_recv    | 一个请求已送到,等待确定         |
| established | 正常数据传输状态                |
| fin_wait1   | 应用说他已完成                  |
| fin_wait2   | 另一边已同意释放                |
| itmed_wait  | 等待所有扥组死掉                |
| time_wait   | 表示处理完毕,等待超时结束的请求 |
| last_ack    | 等待所有分组死掉                |

##### 23、查看句柄数

- 查看最大句柄数
  - `ulimit -n `
- 插件23711进程连接的句柄数
  - `lsof -n|awk '{print $2}'|sort|uniq -c |sort -nr|more |grep 23711`

##### 24、服务器开不了机怎么一步步的排查？

- 分析可能开不了机的原因：

  1. 服务器电源是否有松动，认为破坏或者被损坏等
  2. 服务器系统文件丢失，或系统文件意外损坏，扇热不良赵成蓝屏和死机等
  3. 服务器网络参数配置错误，物理链路等问题

##### 25、linux系统中病毒怎么解决？

1. 要查的话先找到病毒文件删除，一般中毒之后cpu，内存，或者网络IO会比较高
   - 使用top命令找到cpu使用率最高的进程，看是否是我们的正常程序
   - 找到进程后使用ps -aux可以找到病毒文件的位置，先不要删除
   - 检查计划任务、开机启动项和病毒文件目录有没有其他的可疑文件等
   - 确保先把病毒的启动文件删除后，在杀掉进程，删除病毒文件
2. 如果实在是找不到的话，最需要做最坏的打算，就是做数据备份然后重装系统

##### 26、说说TCP/IP的七层模型

1. 物理层（一层）:
   - 定义规范、物理接口、典型化的变化，或将数字信号变化，比特（bit）
2. 数据链路层（二层）：
   - 将比特组织成**帧**，对字节进行定义使用物理地址,MAC地址，支持错误检查
3. **网络层**（三层）：
   - 将帧组织成**包**，宝传递路径选择**路由**，将包传递到目标地址，**IP地址**
   - 协议有 ICMP IGMP (IPV4 IPV6) ARP RARP
4. **传输层**（四层）：
   - 解决传输问题，确保数据传输的可靠性，建立、维护，终止虚拟电路；错误检查和恢复
   - 协议有： TCP UDP 

5. 会话层（五层）：
   - 建立、管理、终止应用程序的逻辑通路，即会话
6. 表示层（六层）：
   - 对引用数据格式化、加密等
7. **应用层**（七层）：
   - 为应用程序提供服务接口，用户使用的时候并不关心会话为何建立和保持，也不关心的协商是否加密等
   - 协议有HTTP FTP TFTP SMTP DNS TELNET HTTPS POP3 DHCP等

  

##### 27、你最常用的nginx模块有哪些？简单的介绍下！

1. `rewrite` 模块， 实现重写功能
2. `access` 模块， 控制来源
3. `ngx_http_auth_basic_module`，用户认证模块
4. `ngx_http_gzip_module`， 网络传输模块
5. `ngx_http_proxy_module`， 模式实现代理
6. `ngx_http_upstream_module` 模块事先定义后端服务器列表
7. `ngx_cache_purge`， 实现缓存清除功能
8. `ngx_http_log_module` ，日志模块
9. `ngx_http_ssl_module` ， https模块
10. `ngx_http_stub_status_module`， 状态查看模块

##### 28、用tcpdump嗅探80端口的访问量谁最高？

`tcpdump -i eth0 -tnn dst port 80 -c 1000|awk -F'.' '{print $1","$2","$3","$4}'|sort|uniq -c |sort -nr|head -20`

##### 29、请使用命令取出linux中eth0的IP地址！

1. `ifconfig eth0|sed -n '2p'|cut -d ':'|cut -d " " -f1`
2. `ifconfig eth0|awk 'NR==2'|awk -F ":" '{print $2}'|awk '{print $1}'`
3. ` ifconfig eth0|awk 'NR==2'|awk -F "[: ]+" '{print $4}'`
4. centos7 `ip addr ens33|awk 'FR==2{print $1}'`

##### 30、三次握手和四次挥手

######  三次握手和四次挥手的六个字段

| 字段 | 全写                   | 含义                           |
| ---- | ---------------------- | ------------------------------ |
| SYN  | synchronous            | 同步（发起一个新连接）         |
| FIN  | finish                 | 结束（释放一个连接）           |
| ACK  | acknowleggement        | 确认序号有效                   |
| PSH  | push                   | 接收方应该尽快将报公文给应用层 |
| RST  | reset                  | 重置连接                       |
| URG  | urget pointer is valid | 紧急指针有效                   |



###### 1、为什么链接的时候是三次握手，关闭的时候却是四次挥手？

- 因为服务器端的listen状态下的socket当接收到syn报文建立连接后，他可以吧ack和syn（qck起应答用，而syn起同步作用）在一个报文里来发送。但是关闭连接是，当接收到对方的fin报文通知时，它仅仅表示对方没有数据传给你了；但是未必你的所有的全部发送给对方了，在发送fin报文给对方表示你同意现在可以这里的ack报文和fin报文都是分开的，这就导致了多一次。

###### 2、为什么TIME_WAIT状态还需要等待2MSL后才能返回到CLOSED状态？

- 这是因为虽然双发都同意关闭连接了，而且我收的4个报文也都协调和发送完毕，案例可以直接会到CLOSED状态（就好比STABLISH状态那样）；但是因为我们必须要遐想网络是不可靠的，而你又发保证你最后发送的ACK报文一定被对方收到，因状态下的SOCKET可能会因为超市未收到ACK报文，而重发FIN报文，所有这个TIME_WAIT状态的作用就是用来重发可能丢失的ACK报文的。

###### 3、第三次握手失败了怎么办？

- 当client一server的第三次握手失败之后，级client发送至server的确认连接报文没能送到server，server在等待client恢复ack的过程中超市了， 那么server回想client发送一个RST报文段并进入关闭状态；即：并不等待client第三次握手的ack包重传，直接关闭连接请求，这主要是为了防止洪攻击
- 攻击者会找许多IP向server发送连接请求，从而将server的未连接队列塞满，浪费server的资源。

###### 4、三次握手有什么缺陷可以被黑客利用，用来对服务器进行攻击？

- 黑客仿造大量的IP想Server发送TCP连接请求报文包，从而将server的板连接队列（上文所说的未连接队列，即server接收到连接请求SUN之后将client加入半连接队列中，占满，从而使得server拒绝与其他正常的连接请求。即拒绝服务攻击。

###### 5、怎么防范这种工具？

1. 缩短服务器接收客户端SYN报文之后的等待连接时间、级SYN timeout时间，也就是server接收到SYN报文段，到最后放弃此连接请求的超时时间，将SUN timeout设置的耕地，便可成倍的减少server的负荷，但是锅底的SYN timeout可能会影响正常的TCP建立的连接，一旦网络不通畅便会导致client连接请求失败
2. SYN cookie+ SYN proxy 无缝集成（较好的解决方案）SYN cookie；当server接收到client的SYN之后，不立即分配资源，而是根据client发送过来的SYN包计算出一个cookie，这个cookie值用来存储server返回给client的SYN+ACK数据包中的初始序列号，当client返回第三次握手的ACK包之后进行校验；如果校验成功则server分配资源，建立连接。   SYN porxy代理，作为server与client连接的代理，代替server与client建立三次握手的连接，同时SYN proxy就与server建立三次握手连接，作为代理（网关？）来连通client与server。（类似VPN）。

##### 31、如何添加一块新的50G硬盘到linux服务器作为单独的分区？并正在使用，需要那些操作步骤？

1. 把硬盘放到服务器并连接
2. 建立硬盘分区（通过fdisk命令）
3. 格式化分区
4. 挂载到分区，便可直接使用（可以入到/ect/fatab中，重启自动挂载）

##### 32、如何查看当前linux系统的状态，如CPU等的使用，内存使用，负载等情况？

- linux 系统中`/proc`是个为文件目录,不占用系统空间,及时地反映出内存现在使用的进程情况,其中许多文件都保存系统运行的状态和相关信息对于`/proc中`文件可以使用文件查看命了浏览内容；文件中包含系统特定信息

| 文件          | 信息         |
| ------------- | ------------ |
| cpuinfo       | 主机CPU信息  |
| filesystems   | 文件系统信息 |
| meninfo       | 主机内存信息 |
| version Linux | 内存版本信息 |
| diskstatus    | 磁盘负载情况 |

- 另top命令可以动态的显示当前系统进程用户使用情况，而且是动态的显示出来，尤其是在该命令显示出来对上访的系统情况，进行汇总
- free -m  命令可以查看真是使用内存情况
- dmesg 也是常用来查看系统性能的命令
- `ls /proc/进程号/fd/` 这个目录下面有几个数就是这个进程所使用的的文件句柄的个数

##### 33、`/proc/sys`及子目录的作用

- 该目录的作用是报告各种不同的内核参数，并让你能交互第更改其中的某些；与/proc中的其他文件不同，该目录中的某些文件可以写入，不过这些仅针对root；

##### 34、如何防止DDOS攻击？如果提供足够资源给你，要保证用户访问不影响。

1. 先确定攻击的范围，日过是出于公司内部，那么先暂时性的将这一区域的内部网络封掉；
2. 如果是外部的IP，那么通过防火墙或者软件进行IP过滤，这样能够一定程度上减缓承受的供给压力；
3. 然后在开启备用服务器，如果攻击流量过大，限制大流量访问，先保证大多数的用户可以访问

##### 35、简述CC攻击的原理？如何防止CC攻击？收到CC冬季该如何处理？

- 原理：
  - CC攻击就是攻击者控制某些主机不停地发送大量的数据包，给服务器赵成资源耗尽，一直到宕机崩溃
  - CC攻击主要是用来攻击页面的，CC攻击就是模拟多个用户（多少线程就是多少用户）不停的进行访问那些需要大量数据操作（就是需要大量的CPU时间）的页面，造成服务器资源的浪费，CPU长时间处于100%，永远都有处理不完的连接，直至网络堵塞，正常访问被终止
- 防御：
  1. 防御CC攻击可以以通过多种方法，禁止网站代理访问
  2. 将网站做成静态页面
  3. 限制链接数量
  4. 修改最大超时时间等
  5. 写脚本抓取日志非正常访问的IP，应为这类的攻击不会如同正常用户一样读取网站所需的信息，一般是比较有针对性的访问，将这类IP屏蔽掉，为了防止可能的误伤，可以再对这个屏蔽做一个过期时间。

##### 36、一千万并发，你有哪些方案？【提示这些单用LVS承受不了的】

- 先用智能DNS进行业务分流，负载到不同的lvs上，
- 如果有钱的话可以再lvs前端上F5
- `智能DNS---->F5---->LVS`
- 三层分流后，最后最大的压力其实还是在数据库上

##### 37、讲述你如何做系统优化，提高系统性能，充分利用资源？

1. 优化内存，把不需要的服务关掉
2. 定期清理备份文件，加大磁盘使用空间
3. sysctl.conf文件做内核优化
4. 文件句柄数（打开最大文件数）调到65535
5. 通过修改应用软件的配置文件，对服务器进行优化，提高内存、CPU的使用率

##### 38、IO性能不足，如何调优？

1. 最简单的就是加硬件Raid卡，加大缓存，用更快的磁盘软件的话用deadline
2. 禁用文件的日志，优化性能，
3. oracle的话还尽量用裸磁盘来做数据盘，
4. 不同的业务还可以分开写到不同的盘

##### 39、面对把并发，如何优化MySQL？

1. 数据库方面做双主多从，读写分离，
2. 改应用代码，把不常修改的数据全部写入NoSQL中（比如memcache、redis中）（比如用户登录的账号数据），这样基本把mysql的独压力分担走
3. 优化sql语句，建立合适的索引
4. 数据库设置concurrent_insert直接从表位并发插入，这样可以有效降低大量注册与登录的锁竞争

##### 40、有一WEB服务器，某天用户投诉某个网站速度很慢，如果你是副武器的管理员，请问你如何查找原因？假设服务器有任意操作系统和软件。

1. 首先检查服务器状态，排除硬件故障和系统故障， 排除机器故障
2. 检查网络状态（包括互联情况，ping包延迟，流量大小等）排除网络故障和网卡设备故障等
3. 检查WEB服务器软件运行情况（并发连接、服务器软件配置情况、数据库连接情况等）排除应用服务故障

##### 41、什么是QPS和TPS？

- TPS： Transactions Per Second 事务数/秒 ，每秒事务数
  - 它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求是开始计时，受到服务器响应后，计时结束，以此来计算使用的时间和完成的事务个数。
- QPS： Queries Per Second 每秒查询率
  - 是对一个特定的查询服务其所在规定时间内所处理流量有多少的衡量标准。

##### 42、如何监控QPS和TPS

- QPS:

  ```bash
  question=mysqladmin status|awk '{print $6}'
  uptime=mysqladmin status|awk '{print $2}'
  QPS=question/uptime
  ```

- TPS：

  ```bash
  rollback=mysqladmin extended-ststus|awk '/\<Com_rollback\>/{print $4 }'
  commit=mysqladmin extended-ststus|awk '/\<Com_commit\>/{print $4 }'
  tps=(commit+rollback)/uptime
  ```

  

##### 43、如何查看pid为123进程的环境变量？

- `cat /proc/123/environ`

##### 44、请写出常用服务的端口！

- 服务（端口）：ftp（20 ，21）、dns(53)、snmp（161）、pop3（110）、dhcp（67，68）、nfs（111）、mysql（3306）、samba（137，138，139）